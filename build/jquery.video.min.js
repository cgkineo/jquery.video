(function($){function t(t,n){i(this,t),this.t(n)}$("<style>",{text:"[for][kind=captions]{position:absolute;top:0;left:0;bottom:0;right:0;font-size:22px;font-family:sans-serif;line-height:120%;}[for][kind=captions] .cue{position:absolute;font-size:100%;line-height:120%;}[for][kind=captions] .cue .cue-text{background-color:black;color:white;padding:0.2%;}[for][kind=captions] .cue.horizontal{transform:translateX(-50%);}[for][kind=captions] .cue.lr{transform:translateY(-50%);}[for][kind=captions] .cue.rl{transform:translateY(-50%);}[for][kind=captions] .cue.align-left{text-align:left;}[for][kind=captions] .cue.align-right{text-align:right;}[for][kind=captions] .cue.align-center{text-align:center;}[for][kind=captions] .cue.align-top{text-align:left;}[for][kind=captions] .cue.align-middle{text-align:right;}[for][kind=captions] .cue.align-bottom{text-align:center;}"}).appendTo("head");var i=$.extend,n="prototype";$.indexOfRegex=function(t,i,n){var e=(n=n||0)?t.substring(n):t,s=e.match(i);return s?e.indexOf(s[0])+n:-1},$.lastIndexOfRegex=function(t,i,n){var e=(n=n||0)?t.substring(0,n):t,s=e.match(i);return s?e.lastIndexOf(s[s.length-1]):-1},$.chain=function(t,i){return function(){var e=Array[n].slice.call(arguments,0);return e.unshift(function(){var i=Array[n].slice.call(arguments,0);return t.apply(this,i)}.bind(this)),i.apply(this,e)}};var e=$.chain;$.fn.videos=function(t){var i=this.find("video");switch(i=i.add(this.filter("video")),t){case"destroy":return i.each(function(t,i){i[s.i]&&(i[s.i].destroy(),delete i[s.i])}),i}return i.each(function(i,n){n[s.i]||new s($(n),t)}),i};var s=$.Video=function t(i,n){this.id=++t.n,this.el=i[0],this.$el=i,this.el[t.i]=this,this.options=this.e={},this.defaults(),this.setOptions(n),this.initialize()};i(s,{n:0,s:0,r:{},i:"player",a:["play","pause","timeupdate","finish"],removeEventsHandler:function(){var t=s.r;if(s.s)for(var i in t){var n=t[i],e=n.$el;n.forEach(function(t){s.a.forEach(function(t){e.off(t,s.o)})}),delete t[i],s.s--}},o:function(t,n){i(t,n);var e=s.r,r=t.currentTarget,a=t.currentTarget[s.i].id;if(a){var o=e[a];if(o&&o.length){var c=r[s.i];o.forEach(function(i){i.callback.call(c,t,i.e)})}}}}),i(s[n],{defaults:function(){},setOptions:function(t){i(this.e,t)},initialize:function(){},destroy:function(){delete this.el[s.i],this.id=null,this.el=null,this.$el=null},addEventsHandler:function(t,i){var n=s.r;if(t){var e=this.el;this.e.eventsHandler||(this.e.eventsHandler=!0,n[e[s.i].id]=[],n[e[s.i].id].$el=this.$el,s.a.forEach(function(t){this.$el.on(t,s.o)}.bind(this)),s.s++);for(var r=n[e[s.i].id],a=0,o=r.length;a<o;a++){var c=r[a];if(c.callback===t&&c.context===this)return}r.push({context:this,callback:t,options:i})}},removeEventsHandler:function(t){var i=this.el,n=s.r;if(this.e.eventsHandler&&s.s){var e=n[i[s.i].id];if(e&&e.length)if(t)for(var r=e.length-1;r>-1;r--){var a=e[r];if(a.context===this&&a.callback===t){e.splice(r,1),e.length||(s.a.forEach(function(t){this.$el.off(t,s.o)}.bind(this)),delete n[this.id],this.e.eventsHandler=!1,s.s--);break}}else e.forEach(function(t){s.a.forEach(function(t){this.$el.off(t,s.o)}.bind(this))}.bind(this)),delete n[this.id],this.e.eventsHandler=!1,s.s--}},destroy:e(s[n].destroy,function(t){this.removeEventsHandler(),t()})}),i(t,{c:0}),i(t[n],{h:null,l:null,u:!1,f:!1,t:function(t){$.ajax({url:this.src,dataType:"text",success:function(i){this.d(i),this.v=!1,this.u=!0,t&&t(this)}.bind(this),error:function(i){this.v=i,this.u=!0,t&&t(this)}.bind(this)})},isReady:function(){return this.u&&!this.v},d:function(n){var e=n.indexOf("\r\n")>-1?"\r\n":"\n",s=n.split(e);this.h=[],this.l=[];for(var r=[],a=0,o=s.length;a<o;a++){var c=s[a],h=a===s.length-1,l=!c;if(h&&!l&&r.push(c),(h||l)&&r.length){if(r[0].toLowerCase().indexOf("webvtt")>-1&&(r.splice(0,1),!r.length))continue;this.h.push({id:++t.c,title:"",start:null,end:null,placement:null,lines:r}),r=[]}else l||r.push(c)}this.h=this.h.filter(function(t){if(0!==t.lines[0].indexOf("NOTE")){if(0===t.lines[0].indexOf("STYLE"))return t.lines.splice(0,1),void this.l.push(t.lines.join("\n"));if(-1===t.lines[0].indexOf("--\x3e")&&(t.title=t.lines[0],t.lines.shift()),-1===t.lines[0].indexOf("--\x3e"))throw"Error";return i(t,this.p(t.lines[0])),t.lines.shift(),!0}}.bind(this))},p:function(t){t=t.trim();var i=$.indexOfRegex(t,/-->/);if(-1===i)throw"Time declaration error, no --\x3e";var n=t.slice(0,i).trim();t=t.slice(i);var e=$.indexOfRegex(t,/[0-9]+/);if(-1===e)throw"Time declaration error, no end time";t=t.slice(e),-1===(i=$.indexOfRegex(t,/[ ]{1}/))&&(i=t.length);var s=t.slice(0,i).trim();return t=t.slice(i),{start:this.g(n),end:this.g(s),placement:this.m(t)}},_:[.001,1,60,360],g:function(t){var i=t.split(/[\:\.\,]{1}/g).reverse();if(i.length<3)throw"Time declaration error, mm:ss.ttt or hh:mm:ss.tt";for(var n=0,e=0,s=i.length;e<s;e++)n+=this._[e]*parseInt(i[e]);return n},m:function(t){var i={line:-1,position:"50%",size:"100%",align:"middle"};t.split(" ").filter(function(t){return t}).forEach(function(t){var n=t.split(":"),e=n[1].split(","),s=n[0].toLowerCase();switch(s){case"d":s="vertical";break;case"l":s="line";break;case"t":s="position";break;case"s":s="size";break;case"a":s="align";break;case"vertical":case"line":case"position":case"size":case"align":break;default:throw"Bad position declaration, "+s}i[s]=e[0]||i[s]}),i.vertical="vertical"===i.vertical?"rl":"vertical-lr"===i.vertical?"lr":"horizontal";for(var n in i){var e=i[n];switch(n){case"line":e=String(e||-1);break;case"position":e=String(e||"0%");break;case"size":e=String(e||"100%");break;case"align":switch(e=String(e||"middle")){case"start":case"middle":case"end":break;default:throw"Invalid align declaration"}}}return i}}),i(s,{Lang:t}),i(s[n],{defaults:e(s[n].defaults,function(t){this.setOptions({captions:!1}),t()}),initialize:e(s[n].initialize,function(t){if(!this.e.captions)return t();this.captions("start",this.e),t()}),captions:function(t,i){switch(t){case"start":this.k(i);break;case"stop":this.b(i)}return this},captionLanguages:null,w:null,k:function(t){this.e.captions=!0,this.$=this.$.bind(this),this.y(this.x.bind(this)),this.z=$("[for='"+this.$el.attr("id")+"'][kind=captions],[for='"+this.$el.attr("id")+"'][kind=subtitles]"),this.z.on("click",this.$),t=i({},this.e,t,{captions:!0}),this.addEventsHandler(this.T,t)},$:function(){this.$el[0].paused?this.$el[0].play&&this.$el[0].play():this.$el[0].pause&&this.$el[0].pause()},x:function(t){this.captionLanguages=t,this.w=null;for(var i in t)if(this.captionLanguages[i].default){this.w=this.captionLanguages[i];break}},T:function(t,i){if(!t.realtime&&this.captionLanguages){var n=this.el.currentTime,e={},s=0;if(this.z.each(function(t,i){var n=$(i),r=n.attr("srclang");this.captionLanguages[r]&&(e[r]||(e[r]=[],s++),e[r].push(n))}.bind(this)),s)for(var r in e){var a=$(e[r]),o=this.captionLanguages[r],c=o.h.filter(function(t){return t.start<=n&&t.end>=n&&!t.live}),h=o.h.filter(function(t){return(t.start>n||t.end<n)&&t.live});if(0===c.length&&0===h.length)return;a.each(function(t,i){var n=$(i);c.forEach(function(t){t.live=!0,n.append($("<span>",this.E({id:t.id,lang:r,class:"cue"},t)).append($("<span>",{class:"cue-text",html:t.lines.join("<br>")})))}.bind(this)),h.forEach(function(t){t.live=!1,n.find("#"+t.id+".cue").remove()}),n.find(".cue:not([lang="+r+"])").remove()}.bind(this))}}},E:function(t,i){var n=t.class.split(" ");n.push(i.placement.vertical);var e="",s=i.placement;switch(s.vertical){case"horizontal":switch(s.align){case"start":n.push("align-left");break;case"middle":n.push("align-center");break;case"end":n.push("align-right")}e+="width:"+s.size+";",e+="left:"+s.position+";",(r=String(s.line).indexOf("%")>-1)||s.line>=0?(s.line,e+="top:"+s.line+"%"):e+="bottom:"+(100-100*Math.abs(s.line))+"%";break;case"rl":switch(s.align){case"start":n.push("align-top");break;case"middle":n.push("align-middle");break;case"end":n.push("align-bottom")}e+="height:"+s.size+";",e+="top:"+s.position+";",(r=String(s.line).indexOf("%")>-1)||s.line>=0?(s.line,e+="left:"+s.line+"%"):e+="right:"+(100-100*Math.abs(s.line))+"%";break;case"lr":switch(s.align){case"start":n.push("align-top");break;case"middle":n.push("align-middle");break;case"end":n.push("align-bottom")}e+="height:"+s.size+";",e+="top:"+s.position+";";var r=String(s.line).indexOf("%")>-1;r||s.line>=0?(s.line,e+="right:"+s.line+"%"):e+="left:"+(100-100*Math.abs(s.line))+"%"}return t.class=n.join(" "),t.style=e,t},b:function(t){this.e.captions=!1,this.z.html(""),this.S=null,this.z=null,t=i({},this.e,t,{captions:!1}),this.removeEventsHandler(this.T)},y:function(t){function i(i){i.isReady()?n++:(e--,delete r[i.lang]),n===e&&t&&t(r)}if("function"!=typeof t&&(t=null),this.captionLanguages)return t(this.captionLanguages);var n=0,e=0,r={};return this.$el.find("track[type='text/vtt']").each(function(t,n){var a=$(n),o=a.attr("srclang"),c=a.attr("src");if(o&&c){if(r[o])return;e++,r[o]=new s.Lang({default:void 0!==a.attr("default"),lang:o,src:c,label:a.attr("label")},i)}}).remove(),r},destroy:e(s[n].destroy,function(t){this.z.off("click",this.$),this.b(),t()})}),i($.fn,{play:function(){return this.videos().each(function(t,i){i.play()}),this},pause:function(){return this.videos().each(function(t,i){i.pause()}),this},mute:function(t){var i=void 0===t;return t=Boolean(t),this.videos().each(function(n,e){if(t||i&&!e.muted)return e.muted=!0,void(e.volume=0);e.muted=!1,e.volume=1}),this},loop:function(t){var i=void 0===t;return t=Boolean(t),this.videos().each(function(n,e){t||i&&!e.loop?e.loop=!0:e.loop=!1}),this}}),i(s[n],{defaults:e(s[n].defaults,function(t){this.setOptions({muted:Boolean(this.$el.attr("muted"))||!1,loop:Boolean(this.$el.attr("loop"))||!1}),t()}),initialize:e(s[n].initialize,function(t){this.$el.mute(this.e.muted),this.$el.loop(this.e.loop),t()})});var r=window.requestAnimationFrame;i(s,{H:[],R:0,B:62.5,L:function(t){t.e.realtime||(t.e.realtime=!0,s.H.push(t),r(s.I))},I:function(){if(s.H.length){var t=Date.now();if(t-s.R<s.B)return r(s.I);s.R=t,s.H.forEach(function(t){t.el.paused||t.$el.trigger("timeupdate",{realtime:!0})}),r(s.I)}},M:function(t){if(t.e.realtime){t.e.realtime=!1;for(var i=s.H.length-1;i>-1;i--)if(s.H[i]===t)return void s.H.splice(i,1)}}}),i(s[n],{defaults:e(s[n].defaults,function(t){this.setOptions({realtime:!1}),t()}),initialize:e(s[n].initialize,function(t){if(!this.e.realtime)return t();this.realtime("start"),t()}),realtime:function(t){switch(t){case"start":this.Y();break;case"stop":this.A()}return this},Y:function(){this.addEventsHandler(this.D),this.el.paused||s.L(this)},D:function(t,i){switch(t.type){case"play":if(this.e.realtime)return;s.L(this);break;case"pause":case"finish":if(!this.e.realtime)return;s.M(this)}},A:function(){this.removeEventsHandler(this.D),s.M(this)},destroy:e(s[n].destroy,function(t){this.A(),t()})});})(jQuery);