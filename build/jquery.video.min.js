(function($){function t(t,s){i(this,t),this.t(s)}$("<style>",{text:"[for][kind=buffering]{position:absolute;top:0;left:0;bottom:0;right:0;font-size:22px;font-family:sans-serif;line-height:120%;}[for][kind=buffering]{display:none;}[for][kind=buffering].buffering{display:block;}[for][kind=captions]{position:absolute;top:0;left:0;bottom:0;right:0;font-size:22px;font-family:sans-serif;line-height:120%;}[for][kind=captions] .cue{position:absolute;font-size:100%;line-height:120%;}[for][kind=captions] .cue .cue-text{background-color:black;color:white;padding:0.2%;}[for][kind=captions] .cue.horizontal{transform:translateX(-50%);}[for][kind=captions] .cue.lr{transform:translateY(-50%);}[for][kind=captions] .cue.rl{transform:translateY(-50%);}[for][kind=captions] .cue.align-left{text-align:left;}[for][kind=captions] .cue.align-right{text-align:right;}[for][kind=captions] .cue.align-center{text-align:center;}[for][kind=captions] .cue.align-top{text-align:left;}[for][kind=captions] .cue.align-middle{text-align:right;}[for][kind=captions] .cue.align-bottom{text-align:center;}[for][kind=controls]{position:absolute;top:0;left:0;bottom:0;right:0;font-size:22px;font-family:sans-serif;line-height:120%;}[for][kind=controls].playing .big-play{display:none;}[for][kind=poster]{position:absolute;top:0;left:0;bottom:0;right:0;font-size:22px;font-family:sans-serif;line-height:120%;}[for][kind=poster].paused.in-middle img,[for][kind=poster].playing img{display:none;}"}).appendTo("head");var i=$.extend,s="prototype";$.indexOfRegex=function(t,i,s){var n=(s=s||0)?t.substring(s):t,e=n.match(i);return e?n.indexOf(e[0])+s:-1},$.lastIndexOfRegex=function(t,i,s){var n=(s=s||0)?t.substring(0,s):t,e=n.match(i);return e?n.lastIndexOf(e[e.length-1]):-1},$.chain=function(t,i){return function(){var n=Array[s].slice.call(arguments,0);return n.unshift(function(){var i=Array[s].slice.call(arguments,0);return t.apply(this,i)}.bind(this)),i.apply(this,n)}};var n=$.chain;$.fn.videos=function(t){var i=this.find("video");switch(i=i.add(this.filter("video")),t){case"destroy":return i.each(function(t,i){i[e.i]&&(i[e.i].destroy(),delete i[e.i])}),i}return i.each(function(i,s){s[e.i]||new e($(s),t)}),i};var e=$.Video=function t(i,s){this.id=++t.s,this.el=i[0],this.$el=i,this.el[t.i]=this,this.options=this.n={},this.defaults(),this.setOptions(s),this.initialize()};i(e,{s:0,e:0,a:{},i:"player",r:["load","waiting","preplay","play","pause","timeupdate","finish"],removeEventsHandler:function(){var t=e.a;if(e.e)for(var i in t){var s=t[i],n=s.$el;s.forEach(function(t){e.r.forEach(function(t){n.off(t,e.o)})}),delete t[i],e.e--}},o:function(t,s){i(t,s);var n=e.a,a=t.currentTarget,r=t.currentTarget[e.i].id;if(r){var o=n[r];if(o&&o.length){var h=a[e.i];o.forEach(function(i){i.callback.call(h,t,i.n)})}}}}),i(e[s],{defaults:function(){},setOptions:function(t){i(this.n,t)},initialize:function(){},destroy:function(){delete this.el[e.i],this.id=null,this.el=null,this.$el=null},addEventsHandler:function(t,i){var s=e.a;if(t){var n=this.el;this.n.eventsHandler||(this.n.eventsHandler=!0,s[n[e.i].id]=[],s[n[e.i].id].$el=this.$el,e.r.forEach(function(t){this.$el.on(t,e.o)}.bind(this)),e.e++);for(var a=s[n[e.i].id],r=0,o=a.length;r<o;r++){var h=a[r];if(h.callback===t&&h.context===this)return}a.push({context:this,callback:t,options:i})}},removeEventsHandler:function(t){var i=this.el,s=e.a;if(this.n.eventsHandler&&e.e){var n=s[i[e.i].id];if(n&&n.length)if(t)for(var a=n.length-1;a>-1;a--){var r=n[a];if(r.context===this&&r.callback===t){n.splice(a,1),n.length||(e.r.forEach(function(t){this.$el.off(t,e.o)}.bind(this)),delete s[this.id],this.n.eventsHandler=!1,e.e--);break}}else n.forEach(function(t){e.r.forEach(function(t){this.$el.off(t,e.o)}.bind(this))}.bind(this)),delete s[this.id],this.n.eventsHandler=!1,e.e--}},destroy:n(e[s].destroy,function(t){this.removeEventsHandler(),t()})}),i($.fn,{play:function(){return this.videos().each(function(t,i){i[e.i].play()}),this},pause:function(){return this.videos().each(function(t,i){i[e.i].pause()}),this},mute:function(t){var i=void 0===t;return t=Boolean(t),this.videos().each(function(s,n){if(t||i&&!n.muted)return n.muted=!0,void(n.volume=0);n.muted=!1,n.volume=1}),this},loop:function(t){var i=void 0===t;return t=Boolean(t),this.videos().each(function(s,n){t||i&&!n.loop?n.loop=!0:n.loop=!1}),this}}),i(e[s],{defaults:n(e[s].defaults,function(t){this.setOptions({muted:Boolean(this.$el.attr("muted"))||!1,loop:Boolean(this.$el.attr("loop"))||!1,controls:!0}),t()}),initialize:n(e[s].initialize,function(t){this.$el.mute(this.n.muted),this.$el.loop(this.n.loop),this.handleInputEvent=this.handleInputEvent.bind(this),this.h=this.h.bind(this),this.n.controls&&this.controls("start"),t()}),controls:function(t,i){switch(t){case"start":this.c(i);break;case"stop":this.l(i)}return this},play:function(){this.$el[0].play&&(this.$el.trigger("preplay"),this.$el[0].play())},pause:function(){this.$el[0].play&&this.$el[0].pause()},c:function(t){this.f=$("[for='"+this.$el.attr("id")+"'][kind=controls]"),this.f.on("click",this.handleInputEvent),t=i({},this.n,t,{controls:!0}),this.addEventsHandler(this.u,t)},handleInputEvent:function(t){var i=$(t.target);(i.is("[kind=controls]")||i.is(".play")||0!==i.parents(".play").length)&&this.h()},h:function(){this.$el[0].paused?this.play():this.pause()},u:function(t,i){switch(t.type){case"play":this.f.removeClass("playing paused"),this.f.addClass("playing");break;case"pause":this.f.removeClass("playing paused"),this.f.addClass("paused")}},l:function(t){this.f.off("click",this.handleInputEvent),this.f=null,this.removeEventsHandler(this.u,t)},destroy:n(e[s].destroy,function(t){this.l(),t()})}),i(e[s],{defaults:n(e[s].defaults,function(t){this.setOptions({buffering:!0}),t()}),initialize:n(e[s].initialize,function(t){this.n.buffering&&this.buffering("start"),t()}),buffering:function(t,i){switch(t){case"start":this.d(i);break;case"stop":this.p(i)}return this},d:function(t){this.g=$("[for='"+this.$el.attr("id")+"'][kind=buffering]"),this.g.on("click",this.handleInputEvent),t=i({},this.n,t,{buffering:!0}),this.addEventsHandler(this.v,t)},v:function(t,i){switch(t.type){case"preload":this.n.m=this.el.currentTime;case"timeupdate":case"waiting":case"load":if(this.n.m===this.el.currentTime)if(this.n.k){if(Date.now()-this.n.k>1)return void this.g.addClass("buffering")}else this.n.k=Date.now();else this.n.k=null;case"play":case"pause":this.g.removeClass("buffering"),this.n.m=this.el.currentTime}},p:function(t){this.g.off("click",this.handleInputEvent),this.g=null,this.removeEventsHandler(this.u,t)},destroy:n(e[s].destroy,function(t){this.p(),t()})}),i(t,{b:0}),i(t[s],{_:null,y:null,w:!1,$:!1,t:function(t){$.ajax({url:this.src,dataType:"text",success:function(i){this.x(i),this.z=!1,this.w=!0,t&&t(this)}.bind(this),error:function(i){this.z=i,this.w=!0,t&&t(this)}.bind(this)})},isReady:function(){return this.w&&!this.z},x:function(s){var n=s.indexOf("\r\n")>-1?"\r\n":"\n",e=s.split(n);this._=[],this.y=[];for(var a=[],r=0,o=e.length;r<o;r++){var h=e[r],c=r===e.length-1,l=!h;if(c&&!l&&a.push(h),(c||l)&&a.length){if(a[0].toLowerCase().indexOf("webvtt")>-1&&(a.splice(0,1),!a.length))continue;this._.push({id:++t.b,title:"",start:null,end:null,placement:null,lines:a}),a=[]}else l||a.push(h)}this._=this._.filter(function(t){if(0!==t.lines[0].indexOf("NOTE")){if(0===t.lines[0].indexOf("STYLE"))return t.lines.splice(0,1),void this.y.push(t.lines.join("\n"));if(-1===t.lines[0].indexOf("--\x3e")&&(t.title=t.lines[0],t.lines.shift()),-1===t.lines[0].indexOf("--\x3e"))throw"Error";return i(t,this.T(t.lines[0])),t.lines.shift(),!0}}.bind(this))},T:function(t){t=t.trim();var i=$.indexOfRegex(t,/-->/);if(-1===i)throw"Time declaration error, no --\x3e";var s=t.slice(0,i).trim();t=t.slice(i);var n=$.indexOfRegex(t,/[0-9]+/);if(-1===n)throw"Time declaration error, no end time";t=t.slice(n),-1===(i=$.indexOfRegex(t,/[ ]{1}/))&&(i=t.length);var e=t.slice(0,i).trim();return t=t.slice(i),{start:this.E(s),end:this.E(e),placement:this.S(t)}},H:[.001,1,60,360],E:function(t){var i=t.split(/[\:\.\,]{1}/g).reverse();if(i.length<3)throw"Time declaration error, mm:ss.ttt or hh:mm:ss.tt";for(var s=0,n=0,e=i.length;n<e;n++)s+=this.H[n]*parseInt(i[n]);return s},S:function(t){var i={line:-1,position:"50%",size:"100%",align:"middle"};t.split(" ").filter(function(t){return t}).forEach(function(t){var s=t.split(":"),n=s[1].split(","),e=s[0].toLowerCase();switch(e){case"d":e="vertical";break;case"l":e="line";break;case"t":e="position";break;case"s":e="size";break;case"a":e="align";break;case"vertical":case"line":case"position":case"size":case"align":break;default:throw"Bad position declaration, "+e}i[e]=n[0]||i[e]}),i.vertical="vertical"===i.vertical?"rl":"vertical-lr"===i.vertical?"lr":"horizontal";for(var s in i){var n=i[s];switch(s){case"line":n=String(n||-1);break;case"position":n=String(n||"0%");break;case"size":n=String(n||"100%");break;case"align":switch(n=String(n||"middle")){case"start":case"middle":case"end":break;default:throw"Invalid align declaration"}}}return i}}),i(e,{Lang:t}),i(e[s],{defaults:n(e[s].defaults,function(t){this.setOptions({captions:!1}),t()}),initialize:n(e[s].initialize,function(t){if(!this.n.captions)return t();this.captions("start",this.n),t()}),captions:function(t,i){switch(t){case"start":this.R(i);break;case"stop":this.B(i)}return this},captionLanguages:null,D:null,R:function(t){this.n.captions=!0,this.I(this.L.bind(this)),this.M=$("[for='"+this.$el.attr("id")+"'][kind=captions],[for='"+this.$el.attr("id")+"'][kind=subtitles]"),this.M.on("click",this.handleInputEvent),t=i({},this.n,t,{captions:!0}),this.addEventsHandler(this.Y,t)},L:function(t){this.captionLanguages=t,this.D=null;for(var i in t)if(this.captionLanguages[i].default){this.D=this.captionLanguages[i];break}},Y:function(t,i){if(!t.realtime&&this.captionLanguages){var s=this.el.currentTime,n={},e=0;if(this.M.each(function(t,i){var s=$(i),a=s.attr("srclang");this.captionLanguages[a]&&(n[a]||(n[a]=[],e++),n[a].push(s))}.bind(this)),e)for(var a in n){var r=$(n[a]),o=this.captionLanguages[a],h=o._.filter(function(t){return t.start<=s&&t.end>=s&&!t.live}),c=o._.filter(function(t){return(t.start>s||t.end<s)&&t.live});if(0===h.length&&0===c.length)return;r.each(function(t,i){var s=$(i);h.forEach(function(t){t.live=!0,s.append($("<span>",this.A({id:t.id,lang:a,class:"cue"},t)).append($("<span>",{class:"cue-text",html:t.lines.join("<br>")})))}.bind(this)),c.forEach(function(t){t.live=!1,s.find("#"+t.id+".cue").remove()}),s.find(".cue:not([lang="+a+"])").remove()}.bind(this))}}},A:function(t,i){var s=t.class.split(" ");s.push(i.placement.vertical);var n="",e=i.placement;switch(e.vertical){case"horizontal":switch(e.align){case"start":s.push("align-left");break;case"middle":s.push("align-center");break;case"end":s.push("align-right")}n+="width:"+e.size+";",n+="left:"+e.position+";",(a=String(e.line).indexOf("%")>-1)||e.line>=0?(e.line,n+="top:"+e.line+"%"):n+="bottom:"+(100-100*Math.abs(e.line))+"%";break;case"rl":switch(e.align){case"start":s.push("align-top");break;case"middle":s.push("align-middle");break;case"end":s.push("align-bottom")}n+="height:"+e.size+";",n+="top:"+e.position+";",(a=String(e.line).indexOf("%")>-1)||e.line>=0?(e.line,n+="left:"+e.line+"%"):n+="right:"+(100-100*Math.abs(e.line))+"%";break;case"lr":switch(e.align){case"start":s.push("align-top");break;case"middle":s.push("align-middle");break;case"end":s.push("align-bottom")}n+="height:"+e.size+";",n+="top:"+e.position+";";var a=String(e.line).indexOf("%")>-1;a||e.line>=0?(e.line,n+="right:"+e.line+"%"):n+="left:"+(100-100*Math.abs(e.line))+"%"}return t.class=s.join(" "),t.style=n,t},B:function(t){this.n.captions=!1,this.M.html(""),this.O=null,this.M=null,t=i({},this.n,t,{captions:!1}),this.removeEventsHandler(this.Y)},I:function(t){function i(i){i.isReady()?s++:(n--,delete a[i.lang]),s===n&&t&&t(a)}if("function"!=typeof t&&(t=null),this.captionLanguages)return t(this.captionLanguages);var s=0,n=0,a={};return this.$el.find("track[type='text/vtt']").each(function(t,s){var r=$(s),o=r.attr("srclang"),h=r.attr("src");if(o&&h){if(a[o])return;n++,a[o]=new e.Lang({default:void 0!==r.attr("default"),lang:o,src:h,label:r.attr("label")},i)}}).remove(),a},destroy:n(e[s].destroy,function(t){this.M.off("click",this.handleInputEvent),this.B(),t()})}),i(e[s],{defaults:n(e[s].defaults,function(t){this.setOptions({poster:this.$el.attr("poster")||!1}),t()}),initialize:n(e[s].initialize,function(t){this.n.poster&&this.poster("start"),t()}),poster:function(t,i){switch(t){case"start":this.P(i);break;case"stop":this.N(i)}return this},P:function(t){this.U=$("[for='"+this.$el.attr("id")+"'][kind=poster]"),this.U.each(function(t,i){$(i).append($("<img>",{src:this.n.poster}))}.bind(this)),t=i({},this.n,t,{poster:!0}),this.addEventsHandler(this.X,t)},X:function(t,i){switch(t.type){case"play":this.U.removeClass("playing paused"),this.U.addClass("playing");break;case"pause":this.U.removeClass("playing paused"),this.U.addClass("paused")}var s=this.el.currentTime<=1,n=this.el.currentTime>=this.el.duration-1;this.U[s?"addClass":"removeClass"]("at-start"),this.U[n?"addClass":"removeClass"]("at-end"),this.U[s||n?"removeClass":"addClass"]("in-middle")},N:function(t){this.U=null,this.removeEventsHandler(this.u,t)},destroy:n(e[s].destroy,function(t){this.N(),t()})});var a=window.requestAnimationFrame;i(e,{j:[],q:0,C:62.5,F:function(t){t.n.G||(t.n.G=!0,e.j.push(t),a(e.J))},J:function(){if(e.j.length){var t=Date.now();if(t-e.q<e.C)return a(e.J);e.q=t,e.j.forEach(function(t){t.el.paused&&!t.n.K||t.$el.trigger("timeupdate",{realtime:!0})}),a(e.J)}},Q:function(t){if(t.n.G){t.n.G=!1;for(var i=e.j.length-1;i>-1;i--)if(e.j[i]===t)return void e.j.splice(i,1)}}}),i(e[s],{defaults:n(e[s].defaults,function(t){this.setOptions({realtime:!0}),t()}),initialize:n(e[s].initialize,function(t){if(!this.n.realtime)return t();this.realtime("start"),t()}),realtime:function(t){switch(t){case"start":this.V();break;case"stop":this.W()}return this},V:function(){this.addEventsHandler(this.Z),this.el.paused||e.F(this)},Z:function(t,i){switch(t.type){case"preplay":this.n.K=!0,e.F(this);break;case"play":e.F(this),this.n.K=!1;break;case"pause":case"finish":e.Q(this),this.n.K=!1;break;case"timeupdate":this.n.K=!1}},W:function(){this.removeEventsHandler(this.Z),e.Q(this)},destroy:n(e[s].destroy,function(t){this.W(),t()})});})(jQuery);