<!DOCTYPE html>
<html>
<head>
    <script src="./jquery.v2.js"></script>

    <script src="../src/util/css.js"></script>
    <script src="../src/util/html.js"></script>
    <script src="../src/util/javascript.js"></script>
    <script src="../src/util/data/arrays.js"></script>
    <script src="../src/util/data/numbers.js"></script>
    <script src="../src/util/data/objects.js"></script>
    <script src="../src/util/data/strings.js"></script>
    <script src="../src/util/abstractions/properties.js"></script>
    <script src="../src/util/abstractions/events.js"></script>
    <script src="../src/util/abstractions/class.js"></script>

    <script src="../src/video/video.js"></script>
    <script src="../src/video/extra/device.js"></script>
    <script src="../src/video/extra/ended.js"></script>
    <script src="../src/video/extra/timeupdate.js"></script>

    <script src="../src/webgl/polyfills/OES_texture_float_linear-polyfill.js"></script>
    <script src="../src/webgl/webgl.js"></script>
    <script src="../src/webgl/shader.js"></script>
    <script src="../src/webgl/texture.js"></script>
    <script src="../src/webgl/shaders/brightnesscontrast.js"></script>
    <script src="../src/webgl/shaders/displacement2.js"></script>
    <script src="../src/webgl/shaders/fade2.js"></script>
    <script src="../src/webgl/shaders/huesaturation.js"></script>
    <script src="../src/webgl/shaders/sepia.js"></script>

    <script src="../src/stream/stream.js"></script>
    <script src="../src/stream/frame.js"></script>
    <script src="../src/stream/liveoptions.js"></script>
    <script src="../src/stream/streams/autostream.js"></script>
    <script src="../src/stream/streams/blend.js"></script>
    <script src="../src/stream/streams/outputs/canvasoutput.js"></script>
    <script src="../src/stream/streams/copy.js"></script>
    <script src="../src/stream/streams/inputs/videoinput.js"></script>

    <script src="../src/stream/streams/blends/displacement2.js"></script>
    <script src="../src/stream/streams/blends/fade2.js"></script>
    <script src="../src/stream/streams/blends/split.js"></script>
    <script src="../src/stream/streams/modifiers/brightnesscontrast.js"></script>
    <script src="../src/stream/streams/modifiers/greenscreen.js"></script>
    <script src="../src/stream/streams/modifiers/huesaturation.js"></script>
    <script src="../src/stream/streams/modifiers/sepia.js"></script>

    <script src="../src/ui/ui.js"></script>
    <script src="../src/ui/component.js"></script>
    <script src="../src/ui/components.js"></script>
    <script src="../src/ui/components/captions/captions.js"></script>
    <script src="../src/ui/components/captions/lang.js"></script>
    <script src="../src/ui/components/poster.js"></script>
    <script src="../src/ui/components/rail.js"></script>
    <script src="../src/ui/components/resize.js"></script>
    <script src="../src/ui/components/state.js"></script>
    <script src="../src/ui/components/toggle.js"></script>
    <script src="../src/ui/components/waiting.js"></script>

    <script src="../src/integration/jquery.js"></script>
    <style>

        html, body {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }

        .video-container,
        .canvas-container {
            display: inline-block;
            position: relative;
        }

        .video-container .rail {
            height: 16px;
        }
        .video-container .rail-inner,
        .video-container .buffer-inner {
            height:  100%;
            background: red;
        }

        .video-container .captions {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
        }

        .video-container .controls {
            position: absolute;
            left: 0;
            bottom: 0;
            right: 0;
        }

    </style>
</head>
    <body>
        <div class="video-container">
            <video preload="none" id="c-40" src="c-40.mp4" muted="true" poster="c-40.jpg" size="640px auto" ratio="16:9" style=""><track kind="captions" src="c-40-de.vtt" type="text/vtt" srclang="de" label="Deutsch"><track kind="captions" src="c-40.vtt" type="text/vtt" srclang="en" label="English"></video>
            <div class="captions" for="c-40" kind="captions" srclang="en"></div>
            <div class="poster" for="c-40" kind="poster"></div>
            <div class="waiting" for="c-40" kind="waiting"></div>
            <div class="controls">
                <button class="big-play" for="c-40" kind="toggle">Play</button>
                <div class="scrub" for="c-40" kind="state">
                    <div class="little-playpause" for="c-40" kind="toggle"></div>
                    <div class="rail">
                        <div class="rail-back">
                        </div>
                        <div class="rail-inner" for="c-40" kind="rail">
                        </div>
                        <div class="buffer-inner" for="c-40" kind="buffer">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="canvas-container">
            <canvas id="canvas1"></canvas>
        </div>
    </body>
    <script>
        var $video = $('video').videos();

        var fadeOptions = new Video.LiveOptions({
            "amount": 0
        });
        var modifierOptions = new Video.LiveOptions({
            "contrast": 0.5,
            "brightness": -0.5
        });
        var config = {
            "streams": [
                {
                    "name": "Video1",
                    "options": $video[0],
                    "class": "VideoInputStream"
                },
                {
                    "name": "Copy1",
                    "options": null,
                    "class": "CopyModifyStream"
                },
                {
                    "name": "Modify1",
                    "options": modifierOptions,
                    "class": "BrightnessContrastModifyStream"
                },
                {
                    "name": "Fade1",
                    "options": fadeOptions,
                    "class": "Fade2BlendStream"
                },
                {
                    "name": "Output1",
                    "options": $("canvas")[0],
                    "class": "CanvasOutputStream"
                }
            ],
            "pipes": [
                {
                    "from": "Video1",
                    "to": "Copy1"
                },
                {
                    "from": "Copy1",
                    "to": "Modify1"
                },
                {
                    "from": "Modify1",
                    "to": "Fade1"
                },
                {
                    "from": "Video1",
                    "to": "Fade1"
                },
                {
                    "from": "Fade1",
                    "to": "Output1"
                }
            ]
        };

        var auto = new Video.AutoStream(config);

        var bounceOut = true; var waitTime = 0; setInterval(function() {
            var now = Date.now();
            if (waitTime + 2000 > now) return;
            if (fadeOptions.amount >= 1) { bounceOut = false; waitTime = now; }
            else if (fadeOptions.amount <= 0) { bounceOut = true; waitTime = now; }
            if (bounceOut) fadeOptions.amount+=0.01;
            else fadeOptions.amount-=0.01;
        }, 20);
    </script>
</html>
